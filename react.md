## æ•´ä½“æµç¨‹å›¾ï¼ˆé«˜å±‚ï¼‰

```text
[ç”¨æˆ·è¾“å…¥é—®é¢˜]
        â”‚
        â–¼
[ReAct Agent å¾ªç¯ï¼šå¤šæ­¥è§„åˆ’ + å·¥å…·è°ƒç”¨]
        â”‚
        â–¼
[ç”Ÿæˆæœ€ç»ˆå›ç­”ï¼ˆæ€»ç»“æ•´ä¸ªè¿‡ç¨‹ï¼‰]
        â”‚
        â–¼
[è¿”å›ç»™å‰ç«¯ / è°ƒç”¨æ–¹]
```

---

## ReAct Agent å¾ªç¯å†…éƒ¨æµç¨‹

æˆ‘ä»¬æŠŠæ ¸å¿ƒçš„ `run_react_agent(question)` å±•å¼€ï¼Œç”»æˆä¸€ä¸ªæ›´ç»†çš„æµç¨‹å›¾ï¼ˆæ¯ä¸€è½® step çš„é€»è¾‘éƒ½ä¸€æ ·ï¼‰ï¼š

```text
(1) æ¥æ”¶ç”¨æˆ·é—®é¢˜ question
        â”‚
        â–¼
(2) åˆå§‹åŒ– history = []ï¼ˆè¿˜æ²¡æœ‰ä»»ä½•è°ƒç”¨è®°å½•ï¼‰
        â”‚
        â–¼
(3) è¿›å…¥å¾ªç¯ï¼šfor step in 1..MAX_STEPS
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3.1 æ„é€ æœ¬è½®æç¤ºè¯ messages                â”‚
â”‚     - System: REACT_SYSTEM_PROMPT         â”‚
â”‚       Â· ä»‹ç»è‡ªå·±æ˜¯ Agent                   â”‚
â”‚       Â· åˆ—å‡ºæ‰€æœ‰å·¥å…·ï¼ˆmovie_basic_info ç­‰ï¼‰ â”‚
â”‚       Â· è§„å®šè¾“å‡ºæ ¼å¼ï¼š                     â”‚
â”‚         Thought / Action / Action Input   â”‚
â”‚     - User:                               â”‚
â”‚       Â· ç”¨æˆ·é—®é¢˜ question                  â”‚
â”‚       Â· å½“å‰ historyï¼ˆæ¯æ­¥çš„ T/A/Oï¼‰        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3.2 è°ƒç”¨ Agent æ¨¡å‹ï¼ˆQwen3-maxï¼‰           â”‚
â”‚     - è¾“å…¥ï¼šmessages                       â”‚
â”‚     - è¾“å‡ºï¼šä¸€æ®µæ–‡æœ¬ï¼Œå½¢å¦‚ï¼š               â”‚
â”‚       Thought: ...                         â”‚
â”‚       Action: movies_by_director           â”‚
â”‚       Action Input: { ... }               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3.3 è§£æè¾“å‡ºï¼ˆparse_react_outputï¼‰         â”‚
â”‚     - ä»æ–‡æœ¬ä¸­æŠ½å–ï¼š                       â”‚
â”‚       thought = "æˆ‘éœ€è¦å…ˆæŸ¥å¯¼æ¼”..."        â”‚
â”‚       action = "movies_by_director"        â”‚
â”‚       params = { "name": "Christopher Nolan" } â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3.4 åˆ¤æ–­æ˜¯å¦ç»“æŸï¼š                         â”‚
â”‚     å¦‚æœ action == "finish"ï¼š              â”‚
â”‚       Â· æŠŠæœ¬æ­¥è®°å½•å†™å…¥ history             â”‚
â”‚       Â· è·³å‡ºå¾ªç¯ï¼ˆä¸å†è°ƒç”¨å·¥å…·ï¼‰           â”‚
â”‚     å¦åˆ™ï¼šç»§ç»­ 3.5                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
       å¦
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3.5 è°ƒç”¨å·¥å…·ï¼ˆrun_toolï¼‰                   â”‚
â”‚     - æ ¹æ® action é€‰æ‹© kg_api å‡½æ•°ï¼š        â”‚
â”‚       Â· movie_basic_info â†’ get_movie_basic_info â”‚
â”‚       Â· movies_by_director â†’ get_movies_by_director â”‚
â”‚       Â· ...                                â”‚
â”‚     - ä¼ å…¥ paramsï¼Œæ‰§è¡Œå›¾æŸ¥è¯¢ï¼Œå¾—åˆ° obs     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3.6 ç”Ÿæˆ Observation æ‘˜è¦                   â”‚
â”‚     - summarise_observation(action, obs)   â”‚
â”‚     - ä¾‹å­ï¼š                               â”‚
â”‚       Â· â€œæ‰¾åˆ°ç”µå½±ã€ŠInceptionã€‹(2010)ï¼Œå¯¼æ¼”ï¼šNolanâ€ â”‚
â”‚       Â· â€œå…±æ‰¾åˆ° 10 éƒ¨ç”µå½±ï¼Œç¤ºä¾‹ï¼šMemento, ...â€ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3.7 å†™å…¥ history                           â”‚
â”‚     history.append({                        â”‚
â”‚       "step": step,                        â”‚
â”‚       "thought": thought,                  â”‚
â”‚       "action": action,                    â”‚
â”‚       "action_input": params,              â”‚
â”‚       "observation_summary": summary,      â”‚
â”‚       "raw_observation": obs               â”‚
â”‚     })                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
(3.8) å›åˆ° for å¾ªç¯é¡¶éƒ¨ï¼Œè¿›å…¥ä¸‹ä¸€è½® stepï¼ˆå¸¦ç€æ›´æ–°åçš„ history ç»§ç»­é—® Agent â€œä¸‹ä¸€æ­¥å¹²å•¥â€ï¼‰
```

ç›´åˆ°æŸä¸€è½®ï¼š

```text
Action: finish
Action Input: {}
```

å¾ªç¯ç»“æŸï¼Œè¿›å…¥ç¬¬äºŒé˜¶æ®µï¼šæ€»ç»“å›ç­”ã€‚

---

## æœ€ç»ˆå›ç­”é˜¶æ®µæµç¨‹

```text
(4) ç»“æŸ ReAct å¾ªç¯ï¼Œå¾—åˆ°å®Œæ•´ history
        â”‚
        â–¼
(5) æ„é€ å›ç­”æ¨¡å‹è¾“å…¥ messages
        â”‚
        â”‚  System:
        â”‚    - å‘Šè¯‰æ¨¡å‹ï¼šä½ è¦æ ¹æ® Observation å›ç­”ç”¨æˆ·é—®é¢˜
        â”‚    - ä¸èƒ½ç¼–é€ å›¾è°±ä¸­æ²¡æœ‰çš„ç”µå½±
        â”‚  User:
        â”‚    - ç”¨æˆ·åŸå§‹é—®é¢˜
        â”‚    - æŒ‰ Step1 / Step2 / ... å±•å¼€å®Œæ•´ historyï¼š
        â”‚      Â· æ¯æ­¥ Thought
        â”‚      Â· æ¯æ­¥ Action
        â”‚      Â· æ¯æ­¥ Observation æ‘˜è¦
        â–¼
(6) è°ƒç”¨å›ç­”æ¨¡å‹ï¼ˆQwen3-8Bï¼Œenable_thinking=Trueï¼‰
        â”‚
        â–¼
(7) å¾—åˆ° final_answerï¼ˆMarkdown/ä¸­æ–‡è‡ªç„¶è¯­è¨€ï¼‰
        â”‚
        â–¼
(8) è¿”å›ç»“æœï¼š
    {
      "question": é—®é¢˜,
      "history": [æ‰€æœ‰ step è®°å½•],
      "final_answer": æœ€ç»ˆå›ç­”
    }
```

---

## ç”¨ä¸€å¥è¯å†å¸®ä½ å¯¹é½è®¤çŸ¥

* **ReAct å¾ªç¯**ï¼ˆrun_react_agent å‰åŠæ®µï¼‰å¹²çš„äº‹æ˜¯ï¼š
  â€œå¤šè½®è®© Qwen3-max å†³å®šä¸‹ä¸€æ­¥ç”¨å“ªä¸ªå·¥å…· + ä»€ä¹ˆå‚æ•°ï¼Œä½ å¸®å®ƒå®é™…å»æŸ¥ kg_apiï¼Œç„¶åæŠŠç»“æœï¼ˆObservationï¼‰å†å¡å›å»è®©å®ƒç»§ç»­æƒ³ã€‚â€

* **æœ€ç»ˆå›ç­”é˜¶æ®µ**ï¼ˆrun_react_agent ååŠæ®µï¼‰å¹²çš„äº‹æ˜¯ï¼š
  â€œæŠŠåˆšæ‰æ‰€æœ‰ step çš„ Thought / Action / Observation æ‰“åŒ…ï¼Œäº¤ç»™ Qwen3-8Bï¼Œè®©å®ƒåšä¸€ä¸ªåŸºäºå›¾ç»“æœçš„æ€»ç»“å›ç­”ã€‚â€


é‚£æˆ‘å°±æŒ‰ä½ è¯´çš„ï¼ŒæŠŠåˆšæ‰é‚£å¥—æµç¨‹æ•´ç†æˆå¯ä»¥ç›´æ¥ä¸¢è¿›ä½  README é‡Œçš„è¯´æ˜å°èŠ‚å“ˆ ğŸ‘‡
ï¼ˆä¸‹é¢å°±æ˜¯ä½ å¯ä»¥å¤åˆ¶ç²˜è´´åˆ°æ–‡æ¡£é‡Œçš„å†…å®¹ï¼‰

---

## ReAct ç”µå½± Agent å·¥ä½œæµç¨‹

åœ¨åŸæœ‰ â€œè§„åˆ’ â†’ å›¾æŸ¥è¯¢ â†’ å›ç­”â€ çš„åŸºç¡€ä¸Šï¼Œè¿™ä¸€ç‰ˆå°†é—®ç­”é€»è¾‘å‡çº§ä¸º **ReAct é£æ ¼çš„å¤šæ­¥ Agent**ã€‚
Agent ä¸å†ä¸€æ¬¡æ€§ç”Ÿæˆä¸€ä¸ª `{task, params}`ï¼Œè€Œæ˜¯æŒ‰ **â€œæ€è€ƒï¼ˆReasoningï¼‰â†’ è¡ŒåŠ¨ï¼ˆActingï¼‰â†’ è§‚å¯Ÿï¼ˆObservationï¼‰â†’ å†æ€è€ƒâ€** çš„å¾ªç¯é€æ­¥æ¨è¿›ã€‚

æ•´ä½“å¯ä»¥åˆ†ä¸¤å¤§é˜¶æ®µï¼š

1. **ReAct å¾ªç¯ï¼šå¤šæ­¥è§„åˆ’ + å·¥å…·è°ƒç”¨**
2. **æ€»ç»“é˜¶æ®µï¼šåŸºäºæ•´ä¸ªè¿‡ç¨‹ç”Ÿæˆæœ€ç»ˆå›ç­”**

---

### 1. ReAct å¾ªç¯ï¼šå¤šæ­¥è§„åˆ’ + å·¥å…·è°ƒç”¨

å…¥å£å‡½æ•°ï¼š`run_react_agent(question: str)`

æ ¸å¿ƒæ€æƒ³ï¼š

> æ¨¡å‹æ¯ä¸€è½®åªå†³å®šâ€œä¸‹ä¸€æ­¥åšä»€ä¹ˆâ€ï¼ˆè°ƒç”¨å“ªä¸ªå·¥å…·ã€ç”¨ä»€ä¹ˆå‚æ•°ï¼‰ï¼Œ
> çœŸæ­£æ‰§è¡Œå·¥å…·çš„æ˜¯åç«¯ä»£ç ï¼Œæ‰§è¡Œå®ŒåæŠŠç»“æœï¼ˆObservationï¼‰å†åé¦ˆç»™æ¨¡å‹ï¼Œä½œä¸ºä¸‹ä¸€è½®æ€è€ƒçš„ä¾æ®ã€‚

#### 1.1 åˆå§‹çŠ¶æ€

```text
è¾“å…¥ï¼šç”¨æˆ·é—®é¢˜ question
history = []    # å½“å‰è¿˜æ²¡æœ‰ä»»ä½•å·¥å…·è°ƒç”¨å†å²
step ä» 1 å¼€å§‹ï¼Œæœ€å¤šæ‰§è¡Œ MAX_STEPS è½®
```

#### 1.2 æ¯ä¸€è½® step çš„å†…éƒ¨æµç¨‹

æ¯ä¸€è½® ReAct çš„é€»è¾‘éƒ½ä¸€æ ·ï¼Œå¯ä»¥ç”»æˆä¸‹é¢è¿™ä¸ªå°æµç¨‹å›¾ï¼š

```text
[æ„é€ æœ¬è½®æç¤ºè¯ messages]
        â”‚
        â–¼
[è°ƒç”¨ Agent æ¨¡å‹ (Qwen3-max)]
        â”‚
        â–¼
[è§£æè¾“å‡º â†’ Thought / Action / Action Input]
        â”‚
        â”œâ”€â”€ è‹¥ Action == "finish" â†’ ç»“æŸå¾ªç¯
        â”‚
        â–¼
[è°ƒç”¨åç«¯å·¥å…· (kg_api.xxx)]
        â”‚
        â–¼
[ç”Ÿæˆ Observation æ‘˜è¦]
        â”‚
        â–¼
[å†™å…¥ historyï¼Œè¿›å…¥ä¸‹ä¸€è½®]
```

å…·ä½“æ¥è¯´ï¼š

1. **æ„é€ æœ¬è½®æç¤ºè¯**ï¼š`build_react_messages(question, history)`

   * `system` ä½¿ç”¨ `REACT_SYSTEM_PROMPT`ï¼š

     * è¯´æ˜ Agent çš„è§’è‰²ï¼›
     * åˆ—å‡ºæ‰€æœ‰å¯ç”¨å·¥å…·åŠå…¶å‚æ•°ï¼ˆæ¯”å¦‚ `movie_basic_info`ã€`movies_by_director` ç­‰ï¼‰ï¼›
     * è§„å®šè¾“å‡ºæ ¼å¼å¿…é¡»æ˜¯ï¼š

       ```text
       Thought: ...
       Action: ...
       Action Input: {...}
       ```
   * `user` éƒ¨åˆ†åŒ…å«ï¼š

     * å½“å‰ç”¨æˆ·é—®é¢˜ï¼›
     * å·²æœ‰çš„å†å²æ­¥éª¤ï¼ˆhistoryï¼‰ï¼ŒåŒ…æ‹¬æ¯ä¸€æ­¥çš„ Thought / Action / Action Input / Observation æ‘˜è¦ã€‚

2. **è°ƒç”¨ Agent æ¨¡å‹ï¼ˆQwen3-maxï¼‰**

   * æ¨¡å‹è¾“å‡ºç±»ä¼¼ï¼š

     ```text
     Thought: æˆ‘éœ€è¦å…ˆæŸ¥å‡ºã€ŠInceptionã€‹çš„å¯¼æ¼”æ˜¯è°ã€‚
     Action: movie_basic_info
     Action Input: { "title": "Inception" }
     ```

3. **è§£æè¾“å‡º**ï¼š`parse_react_output(content)`

   * ç”¨æ­£åˆ™ä»æ–‡æœ¬ä¸­æŠ½å–ï¼š

     * `thought`ï¼ˆæ€è€ƒè¿‡ç¨‹ï¼‰
     * `action`ï¼ˆè¦è°ƒç”¨çš„å·¥å…·åï¼‰
     * `params`ï¼ˆJSON å‚æ•°ï¼‰

4. **åˆ¤æ–­æ˜¯å¦ç»“æŸ**

   * å¦‚æœ `action == "finish"`ï¼š

     * å°†æœ¬æ­¥è®°å½•å†™å…¥ `history`ï¼›
     * é€€å‡ºå¾ªç¯ï¼ˆä¸å†è°ƒç”¨ä»»ä½•å·¥å…·ï¼‰ã€‚

5. **è°ƒç”¨åç«¯å·¥å…·**ï¼š`run_tool(action, params)`

   * æ ¹æ®ä¸åŒçš„ `action`ï¼Œæ˜ å°„åˆ° `kg_api` ä¸­çš„å‡½æ•°ï¼Œä¾‹å¦‚ï¼š

     * `movie_basic_info` â†’ `get_movie_basic_info(title)`
     * `movies_by_director` â†’ `get_movies_by_director(name, year_min, ...)`
     * `co_actors` â†’ `get_co_actors(name, top_k)` ç­‰ã€‚
   * å¾—åˆ°ä¸€ä¸ªåŸå§‹ç»“æœ `obs`ï¼ˆä¸€èˆ¬æ˜¯ dict æˆ– listï¼‰ã€‚

6. **ç”Ÿæˆ Observation æ‘˜è¦**ï¼š`summarise_observation(action, obs)`

   * æŠŠåŸå§‹ç»“æœå‹ç¼©æˆä¸€å°æ®µæ–‡å­—ï¼Œç”¨äºä¸‹ä¸€è½®æç¤ºæ¨¡å‹ï¼Œä¾‹å¦‚ï¼š

     * â€œæ‰¾åˆ°ç”µå½±ã€ŠInceptionã€‹(2010)ï¼Œå¯¼æ¼”ï¼šChristopher Nolanã€‚â€
     * â€œå…±æ‰¾åˆ° 10 éƒ¨ç”µå½±ï¼Œç¤ºä¾‹ï¼šMemento(2000)ï¼›The Dark Knight(2008)ï¼›Interstellar(2014)â€¦â€

7. **å†™å…¥ history**

   * æ¯ä¸€æ­¥åœ¨ `history` ä¸­ä¿å­˜ï¼š

     * step åºå·ï¼›
     * thoughtï¼›
     * actionï¼›
     * action_inputï¼ˆåŸå§‹å‚æ•°ï¼‰ï¼›
     * observation_summaryï¼ˆæ‘˜è¦ï¼‰ï¼›
     * raw_observationï¼ˆåŸå§‹ç»“æœï¼Œç”¨äºè°ƒè¯•ï¼‰ï¼›
     * raw_agent_outputï¼ˆæ¨¡å‹åŸå§‹è¾“å‡ºï¼Œä¾¿äºé”™è¯¯åˆ†æï¼‰ã€‚

å¸¦ç€æ›´æ–°åçš„ `history`ï¼Œè¿›å…¥ä¸‹ä¸€è½® stepï¼Œç»§ç»­è®© Agent æ€è€ƒâ€œä¸‹ä¸€æ­¥è¦å¹²ä»€ä¹ˆâ€ï¼Œç›´åˆ°ï¼š

* è¾¾åˆ° `MAX_STEPS`ï¼Œæˆ–è€…
* æ¨¡å‹è¾“å‡º `Action: finish`ã€‚

---

### 2. æ€»ç»“é˜¶æ®µï¼šç”Ÿæˆæœ€ç»ˆå›ç­”

å½“ ReAct å¾ªç¯ç»“æŸåï¼ŒAgent å·²ç»å®Œæˆäº†æ‰€æœ‰â€œæ€è€ƒ + å·¥å…·è°ƒç”¨â€ï¼Œæ¥ä¸‹æ¥è¿›å…¥â€œæ€»ç»“é˜¶æ®µâ€ã€‚

#### 2.1 æ„é€ å›ç­”æ¨¡å‹è¾“å…¥

å‡½æ•°ï¼š`build_answer_messages_from_history(question, history)`

* å°†ç”¨æˆ·é—®é¢˜ + æ•´ä¸ª ReAct `history` å±•å¼€ï¼Œä¾‹å¦‚ï¼š

  ```text
  ç”¨æˆ·é—®é¢˜ï¼šå’Œã€ŠInceptionã€‹åŒä¸€ä¸ªå¯¼æ¼”çš„å…¶ä»–ç”µå½±æœ‰å“ªäº›ï¼Ÿ

  ä¸‹é¢æ˜¯ä½ ï¼ˆä½œä¸º Agentï¼‰åˆšåˆšçš„æ¨ç†ä¸å·¥å…·è°ƒç”¨è¿‡ç¨‹ï¼š

  Step 1:
  Thought: æˆ‘éœ€è¦å…ˆæŸ¥å‡ºè¿™éƒ¨ç”µå½±çš„å¯¼æ¼”æ˜¯è°ã€‚
  Action: movie_basic_info
  Action Input: {"title": "Inception"}
  Observation: æ‰¾åˆ°ç”µå½±ã€ŠInceptionã€‹(2010)ï¼Œå¯¼æ¼”ï¼šChristopher Nolanã€‚

  Step 2:
  Thought: ç°åœ¨æŸ¥è¯¢ Christopher Nolan å¯¼æ¼”çš„å…¶ä»–ç”µå½±ã€‚
  Action: movies_by_director
  Action Input: {"name": "Christopher Nolan", "year_min": 1990}
  Observation: å…±æ‰¾åˆ° 10 éƒ¨ç”µå½±ï¼Œå‰å‡ éƒ¨ç¤ºä¾‹ï¼šMemento(2000)ï¼›The Dark Knight(2008)ï¼›Interstellar(2014)...
  ```

* é…åˆä¸€ä¸ªä¸“ç”¨çš„ `system` æç¤ºè¯ï¼š

  * å£°æ˜è§’è‰²æ˜¯â€œå›ç­”æ€»ç»“å™¨â€ï¼›
  * å¼ºè°ƒåªèƒ½åŸºäº Observation å›ç­”ï¼Œä¸èƒ½ç¼–é€ å›¾è°±ä¸­ä¸å­˜åœ¨çš„ç”µå½±ï¼›
  * æ”¯æŒä½¿ç”¨ Markdown åšç»“æ„åŒ–è¾“å‡ºã€‚

#### 2.2 è°ƒç”¨å›ç­”æ¨¡å‹ï¼ˆQwen3-8Bï¼‰

å‡½æ•°ï¼š`generate_final_answer(question, history)`

* ä½¿ç”¨ `ANSWER_MODEL = "qwen3-8b"`ï¼›
* æ‰“å¼€ `enable_thinking=True`ï¼Œè®©æ¨¡å‹å†…éƒ¨å…ˆè¿›è¡Œæ€è€ƒï¼Œå†è¾“å‡ºæœ€ç»ˆè‡ªç„¶è¯­è¨€å›ç­”ï¼›
* è¿”å›ä¸€æ®µç»“æ„åŒ–ã€å¯ç›´æ¥å±•ç¤ºç»™ç”¨æˆ·çš„ä¸­æ–‡å›ç­”ï¼Œä¾‹å¦‚ï¼š

  > è¿™éƒ¨ç”µå½±ã€ŠInceptionã€‹çš„å¯¼æ¼”æ˜¯ Christopher Nolanã€‚
  > ä»–åœ¨å›¾è°±ä¸­çš„å…¶ä»–ä»£è¡¨ä½œå“åŒ…æ‹¬ï¼š
  >
  > * ã€ŠMementoã€‹ï¼ˆ2000ï¼‰
  > * ã€ŠThe Dark Knightã€‹ï¼ˆ2008ï¼‰
  > * ã€ŠInterstellarã€‹ï¼ˆ2014ï¼‰
  >   â€¦

---

### 3. æœ€ç»ˆè¿”å›ç»“æ„

`run_react_agent` çš„è¿”å›å€¼ç¤ºä¾‹ï¼š

```json
{
  "question": "å’Œã€ŠInceptionã€‹åŒä¸€ä¸ªå¯¼æ¼”çš„å…¶ä»–ç”µå½±æœ‰å“ªäº›ï¼Ÿ",
  "history": [
    {
      "step": 1,
      "thought": "...",
      "action": "movie_basic_info",
      "action_input": { "title": "Inception" },
      "observation_summary": "æ‰¾åˆ°ç”µå½±ã€ŠInceptionã€‹(2010)ï¼Œå¯¼æ¼”ï¼šChristopher Nolanã€‚",
      "raw_observation": {...},
      "raw_agent_output": "Thought: ... Action: ... Action Input: ..."
    },
    {
      "step": 2,
      "thought": "...",
      "action": "movies_by_director",
      "action_input": { "name": "Christopher Nolan", "year_min": 1990 },
      "observation_summary": "å…±æ‰¾åˆ° 10 éƒ¨ç”µå½±ï¼Œå‰å‡ éƒ¨ç¤ºä¾‹ï¼š...",
      "raw_observation": [...],
      "raw_agent_output": "Thought: ... Action: ... Action Input: ..."
    }
  ],
  "final_answer": "ï¼ˆQwen3-8B è¾“å‡ºçš„æœ€ç»ˆå›ç­”æ–‡æœ¬ï¼Œæ”¯æŒ Markdownï¼‰"
}
```

å‰ç«¯å¯ä»¥ï¼š

* ç”¨ `history` åšâ€œAgent æ€è€ƒä¸è°ƒç”¨è¿‡ç¨‹â€çš„å¯è§†åŒ–ï¼›
* ç”¨ `final_answer` åšæœ€ç»ˆå›ç­”å±•ç¤ºï¼›
* ä¹Ÿå¯ä»¥å°† `history` ä¸­çš„å„æ­¥ Observation ä¸å›¾è°±å¯è§†åŒ–è”åŠ¨ï¼Œè¿›ä¸€æ­¥å¢å¼ºå¯è§£é‡Šæ€§ã€‚
